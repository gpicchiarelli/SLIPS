name: Release Libro (Manuale)

# Questo workflow crea una release del libro manualmente
# Utile per versioni milestone (es. 1.0, 2.0)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Versione libro (es. 1.0, 2.0-draft)'
        required: true
        default: '1.0'
      prerelease:
        description: '√à una pre-release?'
        required: true
        type: boolean
        default: false

jobs:
  release-libro:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Compile LaTeX (multi-pass)
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex
          working_directory: libro
          args: -pdf -interaction=nonstopmode
          # Post-compile: bibliografia e indice
          post_compile: |
            biber main || true
            makeindex main || true
      
      # Seconda e terza passata per risolvere riferimenti
      - name: Second pass
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex
          working_directory: libro
          args: -pdf -interaction=nonstopmode
      
      - name: Third pass (final)
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex
          working_directory: libro
          args: -pdf -interaction=nonstopmode
      
      - name: Rename PDF with version
        run: |
          mv libro/main.pdf libro/SLIPS-Libro-v${{ github.event.inputs.version }}.pdf
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: libro-slips-v${{ github.event.inputs.version }}
          path: libro/SLIPS-Libro-v${{ github.event.inputs.version }}.pdf
      
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: libro-v${{ github.event.inputs.version }}
          name: "üìö Libro SLIPS v${{ github.event.inputs.version }}"
          body: |
            ## üìö SLIPS - Libro Accademico v${{ github.event.inputs.version }}
            
            **Swift Language Implementation of Production Systems**  
            *Teoria, Implementazione e Guida Tecnica*
            
            ### üìñ Informazioni
            
            - **Versione**: ${{ github.event.inputs.version }}
            - **Data**: ${{ github.event.head_commit.timestamp }}
            - **Formato**: PDF (A4, 12pt)
            - **Pagine**: ~400
            - **Lingua**: Italiano
            - **Licenza**: Creative Commons BY-SA 4.0
            
            ### üìä Contenuto
            
            #### Capitoli Completi (~190 pagine)
            - ‚úÖ Cap. 1: Introduzione (15 pag)
            - ‚úÖ Cap. 2: Sistemi a Produzione (25 pag)
            - ‚úÖ Cap. 6: Introduzione RETE (30 pag)
            - ‚úÖ Cap. 16: Architettura SLIPS (35 pag)
            - ‚úÖ Cap. 20: Sistema Moduli (25 pag)
            - ‚úÖ Cap. 22: Testing e Validazione (22 pag)
            - ‚úÖ Cap. 24: Best Practices (18 pag)
            - ‚úÖ Appendici A-D: Reference complete (40 pag)
            
            #### Capitoli Stub (~210 pagine)
            - ‚è≥ 19 capitoli con outline (da espandere)
            
            ### üéØ Pubblico
            
            - Studenti di informatica (AI, sistemi esperti)
            - Ricercatori in AI simbolica
            - Sviluppatori Swift
            - Ingegneri di traduzione C‚ÜíSwift
            
            ### üì• Download
            
            Scarica **SLIPS-Libro-v${{ github.event.inputs.version }}.pdf** dagli asset qui sotto.
            
            ### üìö Contenuto Highlights
            
            - **Teoria formale** dei sistemi a produzione
            - **Algoritmo RETE** con dimostrazioni matematiche
            - **Mappatura completa** C ‚Üí Swift
            - **Implementazione dettagliata** con 750+ LOC codice
            - **91 test** analizzati e spiegati
            - **Best practices** per sviluppo
            - **API reference** completa
            - **Bibliografia accademica** (20+ titoli)
            
            ### ü§ù Contributi
            
            Il libro √® open source! Contributi benvenuti:
            - Correzioni e miglioramenti
            - Completamento capitoli stub
            - Nuovi esempi e casi di studio
            - Traduzione in altre lingue
            
            Vedere `libro/CONTRIBUTI.md` per dettagli.
            
            ### ‚öñÔ∏è Licenza
            
            Questo libro √® distribuito con licenza **Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)**.
            
            Sei libero di:
            - ‚úÖ Condividere e redistribuire
            - ‚úÖ Adattare e modificare
            - ‚úÖ Uso commerciale
            
            Con obbligo di:
            - Attribution (citare autori)
            - ShareAlike (stessa licenza per derivati)
            
            Il codice sorgente SLIPS mantiene licenza MIT separata.
            
            ---
            
            **Maintainer**: Contributori SLIPS  
            **Repository**: https://github.com/gpicchiarelli/SLIPS  
            **Documentazione**: https://gpicchiarelli.github.io/SLIPS/
          files: libro/SLIPS-Libro-v${{ github.event.inputs.version }}.pdf
          draft: false
          prerelease: ${{ github.event.inputs.prerelease }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

